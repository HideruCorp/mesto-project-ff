(()=>{"use strict";function e(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.currentUserId,a=r.handleDeleteCardClick,c=r.handleImageClick,i=r.handleLikeUpdate,u=document.getElementById("card-template").content.querySelector(".places__item").cloneNode(!0),l=u.querySelector(".card__image"),s=u.querySelector(".card__title"),d=u.querySelector(".card__like-button");u.querySelector(".card__like-counter"),l.src=e.link,l.alt=e.name,s.textContent=e.name,n(u,e,o);var p=u.querySelector(".card__delete-button");return e.owner._id===o?p.addEventListener("click",function(t){return a(t,e._id)}):p.remove(),d.addEventListener("click",function(n){return t(n,i,e._id)}),l.addEventListener("click",function(){return c(e)}),u}var t=function(e,t,n){var r=e.target.closest(".places__item");t(n,r.querySelector(".card__like-button").classList.contains("card__like-button_is-active"),r)},n=function(e,t,n){var r=e.querySelector(".card__like-button");e.querySelector(".card__like-counter").textContent=t.likes.length;var o=t.likes.map(function(e){return e._id}).includes(n);r.classList.toggle("card__like-button_is-active",o)},r={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"f9359bef-49f9-43de-be9d-6cc36895394c","Content-Type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status," - ").concat(e.statusText))};function a(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function u(e){var t=e.querySelector(".popup__close"),n=!1;t.addEventListener("click",function(){return i(e)}),e.addEventListener("mousedown",function(e){e.target!==e.currentTarget&&(n=!0)}),e.addEventListener("click",function(t){t.target!==t.currentTarget||n||i(e),n=!1})}var l=function(e,t,n){var r=n.inputErrorClass,o=n.errorActiveClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),a&&(a.classList.remove(o),a.textContent="")},s=function(e,t,n){var r=n.buttonInactiveClass;!function(e){return e.some(function(e){return!e.validity.valid})}(e)?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled=!0)},d=function(e){e.preventDefault()},p=function(e,t){var n=Array.from(e.querySelectorAll(t.input.inputSelector)),r=e.querySelector(t.submitButton.buttonSelector);n.forEach(function(n){l(e,n,t.input)}),s(n,r,t.submitButton)};function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),h=document.querySelector(".profile__image-container"),y=h.querySelector(".profile__image"),b=document.querySelector(".popup_type_edit-avatar"),S=document.forms["edit-avatar"],C=S.elements.avatar,k=S.querySelector(".popup__button"),q=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_edit"),E=document.forms["edit-profile"],L=E.elements.name,x=E.elements.description,A=E.querySelector(".popup__button"),U=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_new-card"),T=document.forms["new-place"],w=T.elements["place-name"],D=T.elements.link,j=T.querySelector(".popup__button"),O=document.querySelector(".popup_type_image"),B=O.querySelector(".popup__image"),P=O.querySelector(".popup__caption"),M={formSelector:".popup__form",input:{inputSelector:".popup__input",inputErrorClass:"popup__input-invalid",errorActiveClass:"popup__input-error_active"},submitButton:{buttonSelector:".popup__button",buttonInactiveClass:"popup__button_inactive"}},N={_id:""};function J(e){B.src=e.link,B.alt=e.name,P.textContent=e.name,c(O)}function V(e,t,a){var c=t?function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then(o)}(e):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then(o)}(e);c.then(function(e){n(a,e,N._id)}).catch(function(e){console.error("Ошибка при изменении состояния лайка:",e)})}function H(e,t){var n=e.target.closest(".places__item");(function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then(o)})(t).then(function(){n.remove()}).catch(function(e){console.error("Ошибка при удалении карточки:",e)})}q.addEventListener("click",function(){E.reset(),L.value=v.textContent,x.value=_.textContent,p(g,M),c(g)}),U.addEventListener("click",function(){T.reset(),p(I,M),c(I)}),h.addEventListener("click",function(){S.reset(),p(b,M),c(b)}),u(g),u(I),u(O),u(b),E.addEventListener("submit",function(e){e.preventDefault();var t,n,a,c=A.textContent;A.disabled=!0,A.textContent="Сохранение...",(t={name:L.value,about:x.value},n=t.name,a=t.about,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:n,about:a})}).then(o)).then(function(e){v.textContent=e.name,_.textContent=e.about,i(g)}).catch(function(e){console.error("Ошибка при обновлении профиля:",e)}).finally(function(){A.disabled=!1,A.textContent=c})}),S.addEventListener("submit",function(e){e.preventDefault();var t,n=k.textContent;k.disabled=!0,k.textContent="Сохранение...",(t=C.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then(o)).then(function(e){y.src=e.avatar,i(b)}).catch(function(e){console.error("Ошибка при обновлении аватара:",e)}).finally(function(){k.disabled=!1,k.textContent=n})}),T.addEventListener("submit",function(t){t.preventDefault();var n,a,c,u=j.textContent;j.disabled=!0,j.textContent="Сохранение...",(n={name:w.value,link:D.value},a=n.name,c=n.link,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:a,link:c})}).then(o)).then(function(t){var n=e(t,{currentUserId:N._id,handleDeleteCardClick:H,handleImageClick:J,handleLikeUpdate:V});m.prepend(n),T.reset(),i(I)}).catch(function(e){console.error("Ошибка при добавлении карточки:",e)}).finally(function(){j.disabled=!1,j.textContent=u})}),Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(o),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(o)]).then(function(t){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];N._id=a._id,v.textContent=a.name,_.textContent=a.about,y.src=a.avatar,c.forEach(function(t){var n=e(t,{currentUserId:N._id,handleDeleteCardClick:H,handleImageClick:J,handleLikeUpdate:V});m.append(n)})}).catch(function(e){console.error("Ошибка при загрузке данных:",e)}),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(function(t){t.addEventListener("submit",d),function(e,t){var n=Array.from(e.querySelectorAll(t.input.inputSelector)),r=e.querySelector(t.submitButton.buttonSelector);s(n,r,t),n.forEach(function(o){o.addEventListener("input",function(){!function(e,t,n){t.validity.patternMismatch&&t.value.length>0&&0===t.value.trim().length?t.setCustomValidity("Поле не может содержать только пробелы"):t.validity.patternMismatch?t.setCustomValidity(t.dataset.invalid):t.setCustomValidity(""),t.validity.valid?l(e,t,n):function(e,t,n){var r=n.inputErrorClass,o=n.errorActiveClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),a.textContent=t.validationMessage||t.dataset.errorMessage,a.classList.add(o)}(e,t,n)}(e,o,t.input),s(n,r,t.submitButton)})})}(t,e)})}(M)})();