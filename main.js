/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.currentUserId,a=r.handleDeleteCardClick,i=r.handleImageClick,c=r.handleLikeUpdate,u=document.getElementById("card-template").content.querySelector(".places__item").cloneNode(!0);u.dataset.cardId=t._id;var s=u.querySelector(".card__image"),l=u.querySelector(".card__title"),d=u.querySelector(".card__like-button");u.querySelector(".card__like-counter"),s.src=t.link,s.alt=t.name,l.textContent=t.name,n(u,t,o);var f=u.querySelector(".card__delete-button");return t.owner._id===o?f.addEventListener("click",a):f.remove(),d.addEventListener("click",function(t){return e(t,c)}),s.addEventListener("click",function(){return i(t)}),u}var e=function(t,e){var n=t.target.closest(".places__item"),r=n.querySelector(".card__like-button");e(n.dataset.cardId,r.classList.contains("card__like-button_is-active"),n)},n=function(t,e,n){var r=t.querySelector(".card__like-button");t.querySelector(".card__like-counter").textContent=e.likes.length;var o=e.likes.map(function(t){return t._id}).includes(n);r.classList.toggle("card__like-button_is-active",o)},r={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"f9359bef-49f9-43de-be9d-6cc36895394c","Content-Type":"application/json"}},o=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status," - ").concat(t.statusText))};function a(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function c(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function u(t){t.querySelector(".popup__close").addEventListener("click",function(){return c(t)}),t.addEventListener("mousedown",function(e){e.target!==e.currentTarget&&(t.dataset.isMouseDownInside="true")}),t.addEventListener("click",function(e){e.target===e.currentTarget&&"true"!==e.target.dataset.isMouseDownInside&&c(t),e.target.dataset.isMouseDownInside=""})}function s(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return l(s,"_invoke",function(n,r,o){var a,c,u,s=0,l=o||[],d=!1,f={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,c=0,u=t,f.n=n,i}};function p(n,r){for(c=n,u=r,e=0;!d&&s&&!o&&e<l.length;e++){var o,a=l[e],p=f.p,m=a[2];n>3?(o=m===r)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=p&&((o=n<2&&p<a[1])?(c=0,f.v=r,f.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,f.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,m),c=l,u=m;(e=c<2?t:u)||!d;){a||(c?c<3?(c>1&&(f.n=-1),p(c,u)):f.n=u:f.v=u);try{if(s=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(d=f.n<0)?u:n.call(r,f))!==i)break}catch(e){a=t,c=1,u=e}finally{s=1}}return{value:e,done:d}}}(n,o,a),!0),s}var i={};function c(){}function u(){}function d(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(l(e={},r,function(){return this}),e),p=d.prototype=c.prototype=Object.create(f);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,l(t,o,"GeneratorFunction")),t.prototype=Object.create(p),t}return u.prototype=d,l(p,"constructor",d),l(d,"constructor",u),u.displayName="GeneratorFunction",l(d,o,"GeneratorFunction"),l(p),l(p,o,"Generator"),l(p,r,function(){return this}),l(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:a,m}})()}function l(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}l=function(t,e,n,r){if(e)o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n;else{function a(e,n){l(t,e,function(t){return this._invoke(e,n,t)})}a("next",0),a("throw",1),a("return",2)}},l(t,e,n,r)}function d(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}var f,p,m=new Map,v=function(t,e,n){var r=n.inputErrorClass,o=n.errorActiveClass,a=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r),a.textContent=e.validationMessage||e.dataset.errorMessage||"Неизвестная ошибка",a.classList.add(o)},y=function(t,e,n){var r=n.inputErrorClass,o=n.errorActiveClass,a=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),a&&(a.classList.remove(o),a.textContent="")},h=function(){var t,e=(t=s().m(function t(e){var n,r,o;return s().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,fetch(e,{method:"HEAD"});case 1:if((n=t.v).ok){t.n=2;break}return t.a(2,!1);case 2:return r=n.headers.get("Content-Type"),t.a(2,r&&r.startsWith("image/"));case 3:return t.p=3,o=t.v,console.error("Ошибка при проверке MIME-типа:",o),t.a(2,!1)}},t,null,[[0,3]])}),function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(t){d(a,r,o,i,c,"next",t)}function c(t){d(a,r,o,i,c,"throw",t)}i(void 0)})});return function(t){return e.apply(this,arguments)}}(),_=(f=function(t,e,n){var r=e.value.trim(),o=Array.from(t.querySelectorAll(n.input.inputSelector)),a=t.querySelector(n.submitButton.buttonSelector);if(!r||e.validity.typeMismatch||e.validity.valueMissing)return e.setCustomValidity(""),Promise.resolve();var i=m.get(r);if(void 0!==i){var c=i?"":e.dataset.errorMessage||"URL не ведет на изображение";return e.setCustomValidity(c),i?y(t,e,n.input):v(t,e,n.input),b(o,a,n.submitButton),Promise.resolve(i)}return a.disabled=!0,a.classList.add(n.submitButton.buttonInactiveClass),h(r).then(function(o){m.set(r,o);var a=o?"":e.dataset.errorMessage||"URL не ведет на изображение";return e.setCustomValidity(a),o?y(t,e,n.input):v(t,e,n.input),o}).catch(function(){m.set(r,!1);var o=e.dataset.errorMessage||"Ошибка проверки URL";return e.setCustomValidity(o),v(t,e,n.input),!1}).finally(function(){b(o,a,n.submitButton)})},function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];clearTimeout(p),p=setTimeout(function(){return f.apply(t,n)},500)}),b=function(t,e,n){var r=n.buttonInactiveClass;!function(t){return t.some(function(t){return!t.validity.valid})}(t)?(e.classList.remove(r),e.disabled=!1):(e.classList.add(r),e.disabled=!0)},S=function(t){t.preventDefault()},g=function(t,e){var n=Array.from(t.querySelectorAll(e.input.inputSelector)),r=t.querySelector(e.submitButton.buttonSelector);n.forEach(function(n){y(t,n,e.input)}),b(n,r,e.submitButton)};function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var k=document.querySelector(".places__list"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),q=document.querySelector(".profile__image-container"),x=q.querySelector(".profile__image"),w=document.querySelector(".popup_type_edit-avatar"),A=document.forms["edit-avatar"],I=A.elements.avatar,T=A.querySelector(".popup__button"),U=document.querySelector(".profile__edit-button"),O=document.querySelector(".popup_type_edit"),j=document.forms["edit-profile"],M=j.elements.name,P=j.elements.description,D=j.querySelector(".popup__button"),B=document.querySelector(".profile__add-button"),V=document.querySelector(".popup_type_new-card"),G=document.forms["new-place"],N=G.elements["place-name"],F=G.elements.link,H=G.querySelector(".popup__button"),J=document.querySelector(".popup_type_image"),R=J.querySelector(".popup__image"),z=J.querySelector(".popup__caption"),W={formSelector:".popup__form",input:{inputSelector:".popup__input",inputErrorClass:"popup__input-invalid",errorActiveClass:"popup__input-error_active"},submitButton:{buttonSelector:".popup__button",buttonInactiveClass:"popup__button_inactive"}},$={_id:""};function K(t){R.src=t.link,R.alt=t.name,z.textContent=t.name,i(J)}function Q(t,e,a){var i=e?function(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:r.headers}).then(o)}(t):function(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:r.headers}).then(o)}(t);i.then(function(t){n(a,t,$._id)}).catch(function(t){console.error("Ошибка при изменении состояния лайка:",t)})}function X(t){var e,n=t.target.closest(".places__item");(e=n.dataset.cardId,fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then(o)).then(function(){n.remove()}).catch(function(t){console.error("Ошибка при удалении карточки:",t)})}U.addEventListener("click",function(){j.reset(),M.value=L.textContent,P.value=E.textContent,g(O,W),i(O)}),B.addEventListener("click",function(){G.reset(),g(V,W),i(V)}),q.addEventListener("click",function(){A.reset(),I.value=x.src,g(w,W),i(w)}),u(O),u(V),u(J),u(w),j.addEventListener("submit",function(t){t.preventDefault();var e,n,a,i=D.textContent;D.disabled=!0,D.textContent="Сохранение...",(e={name:M.value,about:P.value},n=e.name,a=e.about,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:n,about:a})}).then(o)).then(function(t){L.textContent=t.name,E.textContent=t.about,c(O)}).catch(function(t){console.error("Ошибка при обновлении профиля:",t)}).finally(function(){D.disabled=!1,D.textContent=i})}),A.addEventListener("submit",function(t){t.preventDefault();var e,n=T.textContent;T.disabled=!0,T.textContent="Сохранение...",(e=I.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then(o)).then(function(t){x.src=t.avatar,c(w)}).catch(function(t){console.error("Ошибка при обновлении аватара:",t)}).finally(function(){T.disabled=!1,T.textContent=n})}),G.addEventListener("submit",function(e){e.preventDefault();var n,a,i,u=H.textContent;H.disabled=!0,H.textContent="Сохранение...",(n={name:N.value,link:F.value},a=n.name,i=n.link,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:a,link:i})}).then(o)).then(function(e){var n=t(e,{currentUserId:$._id,handleDeleteCardClick:X,handleImageClick:K,handleLikeUpdate:Q});k.prepend(n),G.reset(),c(V)}).catch(function(t){console.error("Ошибка при добавлении карточки:",t)}).finally(function(){H.disabled=!1,H.textContent=u})}),Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(o),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(o)]).then(function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,s=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(n,r)||function(t,e){if(t){if("string"==typeof t)return C(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],i=o[1];$._id=a._id,L.textContent=a.name,E.textContent=a.about,x.src=a.avatar,i.forEach(function(e){var n=t(e,{currentUserId:$._id,handleDeleteCardClick:X,handleImageClick:K,handleLikeUpdate:Q});k.append(n)})}).catch(function(t){console.error("Ошибка при загрузке данных:",t)}),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach(function(e){e.addEventListener("submit",S),function(t,e){var n=Array.from(t.querySelectorAll(e.input.inputSelector)),r=t.querySelector(e.submitButton.buttonSelector);b(n,r,e),n.forEach(function(o){o.addEventListener("input",function(){!function(t,e,n){e.validity.patternMismatch&&e.value.length>0&&0===e.value.trim().length?e.setCustomValidity("Поле не может содержать только пробелы"):e.validity.patternMismatch?e.setCustomValidity(e.dataset.invalid):e.validity.tooShort?e.setCustomValidity("Не менее ".concat(e.minLength," символов")):e.validity.tooLong?e.setCustomValidity("Не более ".concat(e.maxLength," символов")):e.setCustomValidity(""),e.validity.valid?y(t,e,n):v(t,e,n)}(t,o,e.input),"url"===o.type&&o.classList.contains("popup__input_type_url--image")?_(t,o,e):b(n,r,e.submitButton)})})}(e,t)})}(W)})();